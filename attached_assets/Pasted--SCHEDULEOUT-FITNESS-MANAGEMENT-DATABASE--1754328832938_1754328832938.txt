-- =============================================
-- SCHEDULEOUT FITNESS MANAGEMENT DATABASE
-- =============================================

-- Tabella utenti (coach, client, gym owner)
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email TEXT NOT NULL UNIQUE,
    password TEXT NOT NULL,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    user_type TEXT NOT NULL, -- 'coach', 'client', 'gym'
    profile_photo TEXT,
    phone TEXT,
    date_of_birth TEXT,
    location TEXT,
    bio TEXT,
    specialization TEXT,
    experience TEXT,
    certifications TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Tabella palestre
CREATE TABLE gyms (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    owner_id UUID NOT NULL REFERENCES users(id),
    name TEXT NOT NULL,
    address TEXT,
    phone TEXT,
    email TEXT,
    description TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Tabella coach
CREATE TABLE coaches (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    gym_id UUID REFERENCES gyms(id),
    hourly_rate INTEGER,
    availability JSONB,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Tabella clienti
CREATE TABLE clients (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id),
    coach_id UUID REFERENCES coaches(id),
    gym_id UUID REFERENCES gyms(id),
    fitness_goals TEXT,
    medical_conditions TEXT,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Tabella esercizi
CREATE TABLE exercises (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    description TEXT,
    category TEXT NOT NULL, -- 'strength', 'cardio', 'flexibility'
    muscle_groups TEXT[],
    equipment TEXT,
    difficulty TEXT NOT NULL, -- 'beginner', 'intermediate', 'advanced'
    instructions TEXT,
    video_url TEXT,
    image_url TEXT,
    duration INTEGER, -- in minutes
    created_by UUID REFERENCES users(id),
    is_public BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Tabella piani di allenamento
CREATE TABLE workout_plans (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name TEXT NOT NULL,
    description TEXT,
    coach_id UUID NOT NULL REFERENCES coaches(id),
    client_id UUID NOT NULL REFERENCES clients(id),
    duration INTEGER NOT NULL, -- weeks
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Tabella allenamenti
CREATE TABLE workouts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    plan_id UUID NOT NULL REFERENCES workout_plans(id),
    name TEXT NOT NULL,
    description TEXT,
    week_number INTEGER NOT NULL,
    day_number INTEGER NOT NULL,
    estimated_duration INTEGER, -- in minutes
    is_completed BOOLEAN DEFAULT false,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Tabella esercizi per allenamento
CREATE TABLE workout_exercises (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    workout_id UUID NOT NULL REFERENCES workouts(id),
    exercise_id UUID NOT NULL REFERENCES exercises(id),
    order_index INTEGER NOT NULL,
    sets INTEGER,
    reps INTEGER,
    weight INTEGER,
    duration INTEGER, -- in seconds for time-based exercises
    rest_time INTEGER, -- in seconds
    notes TEXT
);

-- Tabella inviti
CREATE TABLE invitations (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    inviter_id UUID NOT NULL REFERENCES users(id),
    invitee_email TEXT NOT NULL,
    invitee_id UUID REFERENCES users(id),
    type TEXT NOT NULL, -- 'coach_to_client', 'gym_to_coach'
    status TEXT DEFAULT 'pending', -- 'pending', 'accepted', 'rejected'
    gym_id UUID REFERENCES gyms(id),
    expires_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Inserimento di alcuni esercizi di esempio
INSERT INTO exercises (name, description, category, muscle_groups, equipment, difficulty, instructions) VALUES
('Push-up', 'Classic bodyweight chest exercise', 'strength', ARRAY['chest', 'shoulders', 'triceps'], 'none', 'beginner', 'Start in plank position, lower chest to ground, push back up'),
('Squat', 'Fundamental lower body exercise', 'strength', ARRAY['quadriceps', 'glutes'], 'none', 'beginner', 'Stand with feet shoulder-width apart, lower hips back and down, return to standing'),
('Running', 'Cardiovascular endurance exercise', 'cardio', ARRAY['legs'], 'none', 'beginner', 'Maintain steady pace for desired duration'),
('Deadlift', 'Compound full-body exercise', 'strength', ARRAY['hamstrings', 'glutes', 'back'], 'barbell', 'intermediate', 'Lift barbell from ground to hip level with straight back'),
('Plank', 'Core stability exercise', 'strength', ARRAY['core'], 'none', 'beginner', 'Hold straight body position on forearms and toes');